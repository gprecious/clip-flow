---
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git log:*), Bash(git add:*), Bash(git commit:*), Bash(git branch:*), Bash(git reset:*)
argument-hint: [--dry-run]
description: 변경사항을 분석하여 논리적 단위로 커밋 생성 (의도/효과 포함)
---

# Smart Commit

변경사항을 분석하여 논리적 단위로 커밋을 생성합니다.
리뷰어가 코드 흐름을 이해하기 쉬운 순서로 커밋을 정렬합니다.

## 인자

$ARGUMENTS

옵션:
- `--dry-run`: 미리보기만 (커밋 실행 안 함)

## 현재 Git 상태

- **브랜치**: !`git branch --show-current`
- **상태**:
!`git status`

- **스테이징된 변경 요약**:
!`git diff --cached --stat`

- **스테이징되지 않은 변경 요약**:
!`git diff --stat`

- **스테이징된 전체 diff**:
!`git diff --cached`

- **스테이징되지 않은 전체 diff**:
!`git diff`

- **최근 커밋 (스타일 참고용)**:
!`git log --oneline -10`

## 분석 지침

### 1단계: 엣지 케이스 확인

1. **변경사항 없음**: git status에 변경사항이 없으면 "변경사항이 없습니다." 출력 후 종료
2. **머지 충돌**: 충돌이 있으면 충돌 파일 목록 출력 후 종료
3. **포맷팅만**: 공백/포맷팅 변경만 있으면 단일 `style:` 커밋 생성

### 2단계: 변경사항 분류

모든 변경된 파일을 다음 유형으로 분류:
- `refactor:` - 동작 변경 없는 구조 개선
- `feat:` - 새 기능 추가
- `fix:` - 버그 수정
- `test:` - 테스트 파일
- `docs:` - 문서 업데이트
- `chore:` - 빌드, 설정, 의존성
- `style:` - 포맷팅만

### 3단계: 논리적 그룹화

변경사항을 다음 기준으로 그룹화:
- **기능적 응집도**: 함께 동작하는 변경들
- **파일 관계**: import/export 관계가 있는 파일들
- **단일 책임**: 하나의 목적을 가진 변경들

### 4단계: 커밋 순서 결정

리뷰어가 이해하기 쉬운 순서로 정렬:
1. 인프라/설정 변경 (가장 먼저)
2. 리팩토링
3. 새 기능 구현
4. 테스트
5. 문서 (마지막)

## 커밋 메시지 형식

각 커밋은 다음 형식을 따름:

### 제목 (첫 줄)
- 형식: `type(scope): 한국어 설명`
- 명령형으로 작성 ("추가" not "추가함")
- 마침표 없음

### 본문 (상세 설명)
```
## 의도
왜 이 변경이 필요한가? 어떤 문제를 해결하는가?

## 변경사항
- 구체적 수정 1
- 구체적 수정 2

## 기대효과
- 예상되는 동작 변화
- 관련 컴포넌트에 미치는 영향
```

## 실행 워크플로우

### 미리보기 출력

```
=== 커밋 분석 결과 ===

[N]개 파일 변경 감지. [M]개 커밋 제안:

---
COMMIT 1/M: type(scope): 설명

파일:
  A/M/D 파일경로

의도:
  이 변경이 필요한 이유

변경사항:
  - 구체적 변경 1
  - 구체적 변경 2

기대효과:
  - 예상 효과 1

---
(다음 커밋들...)

---
```

### 사용자 확인

`--dry-run` 플래그가 없으면:
```
이 커밋들을 생성할까요? [y/n/e]
- y: 모두 커밋
- n: 취소
- e: 수정 후 진행
```

### 커밋 실행

사용자가 'y'를 선택하면:
1. 각 그룹의 파일만 스테이징 (`git add`)
2. HEREDOC을 사용하여 멀티라인 커밋 메시지 작성
3. 커밋 푸터 포함:
   ```
   🤖 Generated with Claude Code
   Co-Authored-By: Claude <noreply@anthropic.com>
   ```
4. 모든 커밋 완료 후 요약 출력

## 중요 규칙

- **절대 금지**: force push, destructive git 명령어
- **항상 미리보기**: --dry-run 없어도 기본적으로 확인 요청
- **HEREDOC 사용**: 멀티라인 커밋 메시지에 필수
- **비밀 정보 제외**: .env, credentials 파일 커밋 금지
- **사용자 존중**: 'n' 선택시 즉시 중단
- **원자적 커밋**: 하나의 논리적 변경 = 하나의 커밋
